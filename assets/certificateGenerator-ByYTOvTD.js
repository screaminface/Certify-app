import{P as e,D as r}from"./vendor-misc-DSrITObC.js";import{a as t}from"./index-CGB6qKWg.js";import{s as o}from"./fileDownload-D0s8ICu7.js";import"./vendor-react-BvoEKvLG.js";import"./vendor-dexie-JKmga9jS.js";import"./vendor-dates-qyqZJmaY.js";import"./vendor-uuid-P-OY1HC2.js";import"./vendor-icons-BX-4-bzZ.js";import"./vendor-supabase-BRwdPCI1.js";function n(e){return e.replace(/[/\\:*?"<>|]/g,"").replace(/\s+/g,"_").substring(0,200)}async function i(i,a,s){try{if(!i.personName||!i.uniqueNumber)throw new Error("Missing required participant fields: personName or uniqueNumber");if(!a)throw new Error("Group information is required for certificate generation");const p=5*(a.groupNumber||0),u="/Certify-app/template.docx",m=await fetch(u);if(!m.ok)throw new Error(`Template not found: ${m.status} ${m.statusText}. Please ensure template.docx exists in /public/ folder.`);const c=await m.arrayBuffer(),d=new e(c),l=new r(d,{paragraphLoop:!0,linebreaks:!0,delimiters:{start:"{{",end:"}}"}}),f=Math.random()<.7?{text:"Отличен",value:"6.00"}:{text:"Мн. добър",value:"5.00"},g=s||i.courseEndDate,w=t(g),b=new Date(g).getFullYear().toString(),v={F01:String(i.uniqueNumber||""),F02:w,F03:String(i.personName||""),F04:String(i.egn||""),F05:String(i.birthPlace||""),F06:String(i.citizenship||"българско"),F07:b,F08:String(p),F09:f.text,F10:f.value};l.render(v);const x=l.getZip().generate({type:"blob",mimeType:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}),F=n(i.personName),h=n(i.uniqueNumber),N=`udostoverenie_${h}_${n(i.companyName)}_${F}.docx`;await o(x,N)}catch(p){throw p}}export{i as generateCertificate};
