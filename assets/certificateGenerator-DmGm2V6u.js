import{P as e,D as r}from"./vendor-misc-D39njv3e.js";import{f as t,s as n}from"./index-BwJrWJBt.js";import"./vendor-react-oVSxXMwJ.js";import"./vendor-dexie-sCRMG0Q-.js";import"./vendor-dates-qyqZJmaY.js";import"./vendor-uuid-P-OY1HC2.js";import"./vendor-icons-CWatr7yU.js";import"./vendor-supabase-DKUAFRPn.js";function o(e){return e.replace(/[/\\:*?"<>|]/g,"").replace(/\s+/g,"_").substring(0,200)}async function i(i,a,s){try{if(!i.personName||!i.uniqueNumber)throw new Error("Missing required participant fields: personName or uniqueNumber");if(!a)throw new Error("Group information is required for certificate generation");const p=5*(a.groupNumber||0),u="/Certify-app/template.docx",m=await fetch(u);if(!m.ok)throw new Error(`Template not found: ${m.status} ${m.statusText}. Please ensure template.docx exists in /public/ folder.`);const c=await m.arrayBuffer(),d=new e(c),f=new r(d,{paragraphLoop:!0,linebreaks:!0,delimiters:{start:"{{",end:"}}"}}),l=Math.random()<.7?{text:"Отличен",value:"6.00"}:{text:"Мн. добър",value:"5.00"},g=s||i.courseEndDate,w=t(g),b=new Date(g).getFullYear().toString(),v={F01:String(i.uniqueNumber||""),F02:w,F03:String(i.personName||""),F04:String(i.egn||""),F05:String(i.birthPlace||""),F06:String(i.citizenship||"българско"),F07:b,F08:String(p),F09:l.text,F10:l.value};f.render(v);const x=f.getZip().generate({type:"blob",mimeType:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}),F=o(i.personName),h=o(i.uniqueNumber),N=`udostoverenie_${h}_${o(i.companyName)}_${F}.docx`;await n(x,N)}catch(p){throw p}}export{i as generateCertificate};
