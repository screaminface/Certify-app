import{P as F,D as h}from"./vendor-misc-VdyTtt_u.js";import{a as x}from"./index-BANB8TkJ.js";import{s as y}from"./fileDownload-0ohKhoX7.js";import"./vendor-react-3uLv-P3n.js";import"./vendor-dexie-mu9yNVYX.js";import"./vendor-dates-Dk0ftcM6.js";import"./vendor-uuid-CtRu48qb.js";import"./vendor-icons-QXWXkYnp.js";import"./vendor-supabase-CXFbbOpx.js";function v(){return Math.random()<.7?{text:"Отличен",value:"6.00"}:{text:"Мн. добър",value:"5.00"}}function o(e){return e.replace(/[/\\:*?"<>|]/g,"").replace(/\s+/g,"_").substring(0,200)}async function B(e,n,m){try{if(!e.personName||!e.uniqueNumber)throw new Error("Missing required participant fields: personName or uniqueNumber");if(!n)throw new Error("Group information is required for certificate generation");const r=(n.groupNumber||0)*5,t=await fetch("./template.docx");if(!t.ok)throw new Error(`Template not found: ${t.status} ${t.statusText}. Please ensure template.docx exists in /public/ folder.`);const u=await t.arrayBuffer(),c=new F(u),a=new h(c,{paragraphLoop:!0,linebreaks:!0,delimiters:{start:"{{",end:"}}"}}),i=v(),s=m||e.courseEndDate,f=x(s),l=new Date(s).getFullYear().toString(),d={F01:String(e.uniqueNumber||""),F02:f,F03:String(e.personName||""),F04:String(e.egn||""),F05:String(e.birthPlace||""),F06:String(e.citizenship||"българско"),F07:l,F08:String(r),F09:i.text,F10:i.value};a.render(d);const p=a.getZip().generate({type:"blob",mimeType:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}),g=o(e.personName),N=o(e.uniqueNumber),b=o(e.companyName),w=`udostoverenie_${N}_${b}_${g}.docx`;await y(p,w)}catch(r){throw console.error("Certificate generation failed:",r),r}}export{B as generateCertificate};
