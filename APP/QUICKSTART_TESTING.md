# ‚ö° –ë–™–†–ó –°–¢–ê–†–¢ - –¢–ï–°–¢ –ù–ê READ-ONLY –†–ï–ñ–ò–ú

–ù–∞–π-–±—ä—Ä–∑–∏—è—Ç –Ω–∞—á–∏–Ω –∑–∞ —Ç–µ—Å—Ç–≤–∞–Ω–µ –Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—Ç–æ –ø—Ä–µ–≤–∫–ª—é—á–≤–∞–Ω–µ –∫—ä–º read-only.

---

## üöÄ –í–∞—Ä–∏–∞–Ω—Ç 1: –°—É–ø–µ—Ä –±—ä—Ä–∑ —Ç–µ—Å—Ç (1-2 –º–∏–Ω—É—Ç–∏)

–ò–∑–ø–æ–ª–∑–≤–∞ –∫—Ä–∞—Ç—ä–∫ grace –ø–µ—Ä–∏–æ–¥ –æ—Ç 1 –º–∏–Ω—É—Ç–∞.

### –°—Ç—ä–ø–∫–∏:

```sql
-- 1. –ò–∑–ø—ä–ª–Ω–µ—Ç–µ –≤ Supabase SQL Editor
\i supabase/TEST_short_grace_period.sql

-- 2. –°—Ç–∞—Ä—Ç–∏—Ä–∞–π—Ç–µ —Ç–µ—Å—Ç–∞
SELECT app.test_short_grace_period();

-- 3. –ò–∑—á–∞–∫–∞–π—Ç–µ ~60 —Å–µ–∫—É–Ω–¥–∏

-- 4. –ü—Ä–æ–≤–µ—Ä–µ—Ç–µ —Ä–µ–∑—É–ª—Ç–∞—Ç–∞
SELECT * FROM app.test_check_short_grace_status();
-- –û—á–∞–∫–≤–∞–Ω —Ä–µ–∑—É–ª—Ç–∞—Ç: read_only = true, status = expired

-- 5. –ü–æ—á–∏—Å—Ç–≤–∞–Ω–µ
SELECT app.test_cleanup_short_grace();
```

**–í—Ä–µ–º–µ:** ~2 –º–∏–Ω—É—Ç–∏  
**–¢–µ—Å—Ç–≤–∞:** Subscription expiration ‚Üí Grace period ‚Üí Read-only

---

## üéØ –í–∞—Ä–∏–∞–Ω—Ç 2: –°—Ç–∞–Ω–¥–∞—Ä—Ç–µ–Ω —Ç–µ—Å—Ç (2-3 –º–∏–Ω—É—Ç–∏)

–ò–∑–ø–æ–ª–∑–≤–∞ subscription –∫–æ–π—Ç–æ –∏–∑—Ç–∏—á–∞ —Å–ª–µ–¥ 1 –º–∏–Ω—É—Ç–∞ + 10 –¥–Ω–∏ grace.

### –°—Ç—ä–ø–∫–∏:

```sql
-- 1. –ò–∑–ø—ä–ª–Ω–µ—Ç–µ —Ç–µ—Å—Ç–∞
\i supabase/TEST_expiration_readonly.sql

-- 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ (–∏–∑—á–∞–∫–≤–∞ 70 —Å–µ–∫)
SELECT * FROM app.test_auto_expiration_check(
  (SELECT id FROM app.tenants WHERE code='test-expiry')
);

-- 3. –ü–æ—á–∏—Å—Ç–≤–∞–Ω–µ
SELECT app.test_cleanup_expiration();
```

**–í—Ä–µ–º–µ:** ~2 –º–∏–Ω—É—Ç–∏  
**–¢–µ—Å—Ç–≤–∞:** Subscription expiration —Å–ª–µ–¥ 1 –º–∏–Ω—É—Ç–∞

---

## üîë –í–∞—Ä–∏–∞–Ω—Ç 3: JWT —Ç–µ—Å—Ç

–¢–µ—Å—Ç–≤–∞ JWT token —Å –∫—Ä–∞—Ç–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç.

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞:

1. **Supabase Dashboard:**
   - Settings ‚Üí Auth ‚Üí JWT Expiry: `60` (—Å–µ–∫—É–Ω–¥–∏)

2. **–ò–ª–∏ –≤ config.toml (local dev):**
   ```toml
   [auth]
   jwt_expiry = 60
   ```

3. **–†–µ—Å—Ç–∞—Ä—Ç–∏—Ä–∞–π—Ç–µ Supabase:**
   ```bash
   supabase stop && supabase start
   ```

### –¢–µ—Å—Ç–≤–∞–Ω–µ:

```sql
-- 1. –ò–∑–ø—ä–ª–Ω–µ—Ç–µ —Ç–µ—Å—Ç–∞
\i supabase/TEST_jwt_short_expiry.sql

-- 2. –ò–∑–ª–µ–∑—Ç–µ –∏ –≤–ª–µ–∑—Ç–µ –æ—Ç–Ω–æ–≤–æ –≤ –∞–ø–ª–∏–∫–∞—Ü–∏—è—Ç–∞

-- 3. –ü—Ä–æ–≤–µ—Ä–µ—Ç–µ JWT –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
SELECT * FROM app.test_jwt_info();
-- –û—á–∞–∫–≤–∞–Ω–æ: seconds_until_expiry <= 60

-- 4. –ü—Ä–æ–≤–µ—Ä–µ—Ç–µ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—Ç–∞
SELECT * FROM app.test_expired_jwt_behavior();
```

**–í—Ä–µ–º–µ:** ~2 –º–∏–Ω—É—Ç–∏  
**–¢–µ—Å—Ç–≤–∞:** JWT token —Å 1 –º–∏–Ω—É—Ç–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç

---

## üíª –í–∞—Ä–∏–∞–Ω—Ç 4: Client-Side —Ç–µ—Å—Ç

–¢–µ—Å—Ç–≤–∞–Ω–µ –æ—Ç –±—Ä–∞—É–∑—ä—Ä–∞ (TypeScript).

### –°—Ç—ä–ø–∫–∏:

1. **–û—Ç–≤–æ—Ä–µ—Ç–µ DevTools Console (F12)**

2. **–ò–∑–ø—ä–ª–Ω–µ—Ç–µ:**
   ```javascript
   // –ë—ä—Ä–∑–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞
   await testExpirationReadOnly(false);

   // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ read-only —Ä–µ–∂–∏–º
   await testReadOnlyOperation();
   ```

3. **–ó–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ–Ω —Ç–µ—Å—Ç —Å –∏–∑—á–∞–∫–≤–∞–Ω–µ:**
   ```javascript
   await testExpirationReadOnly(true);
   ```

**–í—Ä–µ–º–µ:** ~1-2 –º–∏–Ω—É—Ç–∏  
**–¢–µ—Å—Ç–≤–∞:** Client-side entitlement –ø—Ä–æ–≤–µ—Ä–∫–∞

---

## ü§ñ –í–∞—Ä–∏–∞–Ω—Ç 5: PowerShell –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

–ò–∑—Ü—è–ª–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–∞–Ω —Ç–µ—Å—Ç.

### –°—Ç—ä–ø–∫–∏:

```powershell
# –ë—ä—Ä–∑ —Ç–µ—Å—Ç (–±–µ–∑ –∏–∑—á–∞–∫–≤–∞–Ω–µ)
.\run-expiration-test.ps1

# –° –∏–∑—á–∞–∫–≤–∞–Ω–µ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ–Ω)
.\run-expiration-test.ps1 -WaitForExpiration

# –ë–µ–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–æ—á–∏—Å—Ç–≤–∞–Ω–µ
.\run-expiration-test.ps1 -SkipCleanup
```

**–í—Ä–µ–º–µ:** ~2-3 –º–∏–Ω—É—Ç–∏  
**–¢–µ—Å—Ç–≤–∞:** –ü—ä–ª–µ–Ω SQL —Ç–µ—Å—Ç —Å—ä—Å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

---

## üìä –û—á–∞–∫–≤–∞–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏

### ‚úÖ –£—Å–ø–µ—à–µ–Ω —Ç–µ—Å—Ç

–°–ª–µ–¥ –∏–∑—Ç–∏—á–∞–Ω–µ –Ω–∞ subscription –∏ grace –ø–µ—Ä–∏–æ–¥:

```
Status: expired
Read-only: true
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ –±–ª–æ–∫–∏—Ä–∞ write –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ –ø–æ–∫–∞–∑–≤–∞ —Å—ä–æ–±—â–µ–Ω–∏–µ –∑–∞ –∏–∑—Ç–µ–∫—ä–ª –∞–±–æ–Ω–∞–º–µ–Ω—Ç.

### ‚è≥ –í grace –ø–µ—Ä–∏–æ–¥

–ê–∫–æ subscription –µ –∏–∑—Ç–µ–∫—ä–ª, –Ω–æ —Å–º–µ –≤ grace –ø–µ—Ä–∏–æ–¥:

```
Status: grace
Read-only: false
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ —Ä–∞–±–æ—Ç–∏ –Ω–æ—Ä–º–∞–ª–Ω–æ.

### üî¥ –ê–∫—Ç–∏–≤–µ–Ω subscription

–ê–∫–æ subscription –µ –∞–∫—Ç–∏–≤–µ–Ω:

```
Status: active
Read-only: false
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ —Ä–∞–±–æ—Ç–∏ –Ω–æ—Ä–º–∞–ª–Ω–æ.

---

## üõ†Ô∏è –ü—Ä–µ–ø–æ—Ä—ä–∫–∏

### –ó–∞ –Ω–∞–π-–±—ä—Ä–∑ —Ç–µ—Å—Ç:
‚Üí **–í–∞—Ä–∏–∞–Ω—Ç 1** (Short Grace Period) - 1-2 –º–∏–Ω—É—Ç–∏

### –ó–∞ –ø—ä–ª–µ–Ω —Ç–µ—Å—Ç:
‚Üí **–í–∞—Ä–∏–∞–Ω—Ç 2** (Standard Test) + **–í–∞—Ä–∏–∞–Ω—Ç 4** (Client-Side) - 3-4 –º–∏–Ω—É—Ç–∏

### –ó–∞ JWT —Ç–µ—Å—Ç–≤–∞–Ω–µ:
‚Üí **–í–∞—Ä–∏–∞–Ω—Ç 3** (JWT Test) - 2-3 –º–∏–Ω—É—Ç–∏

### –ó–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è:
‚Üí **–í–∞—Ä–∏–∞–Ω—Ç 5** (PowerShell) - 2-3 –º–∏–Ω—É—Ç–∏

---

## üßπ –ü–æ—á–∏—Å—Ç–≤–∞–Ω–µ

–°–ª–µ–¥ –≤—Å–µ–∫–∏ —Ç–µ—Å—Ç:

```sql
-- –ó–∞ –í–∞—Ä–∏–∞–Ω—Ç 1
SELECT app.test_cleanup_short_grace();

-- –ó–∞ –í–∞—Ä–∏–∞–Ω—Ç 2
SELECT app.test_cleanup_expiration();

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ –≤—Å–∏—á–∫–∏ —Ç–µ—Å—Ç–æ–≤–∏ –¥–∞–Ω–Ω–∏ —Å–∞ –º–∞—Ö–Ω–∞—Ç–∏
SELECT * FROM app.tenants WHERE code LIKE 'test-%';
-- –û—á–∞–∫–≤–∞–Ω–æ: 0 —Ä–µ–∑—É–ª—Ç–∞—Ç–∞
```

---

## üìö –ü—ä–ª–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ó–∞ –ø–æ–¥—Ä–æ–±–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤–∏–∂—Ç–µ:
- [TEST_README.md](TEST_README.md) - –ü—ä–ª–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `supabase/TEST_*.sql` - SQL —Ç–µ—Å—Ç–æ–≤–∏ —Ñ–∞–π–ª–æ–≤–µ
- `src/utils/testExpirationReadOnly.ts` - TypeScript —Ç–µ—Å—Ç–æ–≤–µ

---

## ‚ùì –ß–µ—Å—Ç–æ —Å—Ä–µ—â–∞–Ω–∏ –≤—ä–ø—Ä–æ—Å–∏

**Q: –ó–∞—â–æ read-only –Ω–µ —Å–µ –∞–∫—Ç–∏–≤–∏—Ä–∞?**  
A: –ü—Ä–æ–≤–µ—Ä–µ—Ç–µ –¥–∞–ª–∏ grace –ø–µ—Ä–∏–æ–¥—ä—Ç –µ –∏–∑—Ç–µ–∫—ä–ª. –ü–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ –µ 10 –¥–Ω–∏.

**Q: –ö–∞–∫ –¥–∞ —Ç–µ—Å—Ç–≤–∞–º —Å –ø–æ-–∫—Ä–∞—Ç—ä–∫ grace?**  
A: –ò–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ –í–∞—Ä–∏–∞–Ω—Ç 1 (Short Grace Period).

**Q: JWT –Ω–µ –∏–∑—Ç–∏—á–∞ —Å–ª–µ–¥ 60 —Å–µ–∫—É–Ω–¥–∏?**  
A: –ü—Ä–æ–≤–µ—Ä–µ—Ç–µ –¥–∞–ª–∏ —Å—Ç–µ –ø—Ä–æ–º–µ–Ω–∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ç–∞ –∏ —Ä–µ—Å—Ç–∞—Ä—Ç–∏—Ä–∞–ª–∏ Supabase.

**Q: –¢–µ—Å—Ç–æ–≤–∏—Ç–µ –¥–∞–Ω–Ω–∏ –Ω–µ —Å–µ —Å—ä–∑–¥–∞–≤–∞—Ç?**  
A: –ü—Ä–æ–≤–µ—Ä–µ—Ç–µ –¥–∞–ª–∏ –∏–º–∞—Ç–µ –ø—Ä–∞–≤–∞ –¥–∞ –∏–∑–ø—ä–ª–Ω—è–≤–∞—Ç–µ SQL –∫–æ–¥–∞.

---

**–ò–∑–≥–æ—Ç–≤–µ–Ω–æ:** 2026-02-17  
**–í–µ—Ä—Å–∏—è:** 1.0
