# üß™ –¢–ï–°–¢–í–ê–ù–ï –ù–ê –ê–í–¢–û–ú–ê–¢–ò–ß–ù–û READ-ONLY –ü–†–ò –ò–ó–¢–ò–ß–ê–ù–ï

–¢–æ–∑–∏ –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å–≤–∞ –∫–∞–∫ –¥–∞ —Ç–µ—Å—Ç–≤–∞—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—Ç–æ –ø—Ä–µ–≤–∫–ª—é—á–≤–∞–Ω–µ –∫—ä–º read-only —Ä–µ–∂–∏–º –ø—Ä–∏ –∏–∑—Ç–∏—á–∞–Ω–µ –Ω–∞ –∞–±–æ–Ω–∞–º–µ–Ω—Ç–∞ –∏ JWT token-–∞.

## üìã –°—ä–¥—ä—Ä–∂–∞–Ω–∏–µ

1. [–û–±—â–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è](#–æ–±—â–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è)
2. [–¢–µ—Å—Ç 1: Subscription Expiration (SQL)](#—Ç–µ—Å—Ç-1-subscription-expiration-sql)
3. [–¢–µ—Å—Ç 2: JWT Short Expiry (SQL)](#—Ç–µ—Å—Ç-2-jwt-short-expiry-sql)
4. [–¢–µ—Å—Ç 3: Client-Side Testing (TypeScript)](#—Ç–µ—Å—Ç-3-client-side-testing-typescript)
5. [–ö–æ–º–±–∏–Ω–∏—Ä–∞–Ω —Ç–µ—Å—Ç](#–∫–æ–º–±–∏–Ω–∏—Ä–∞–Ω-—Ç–µ—Å—Ç)
6. [–ü–æ—á–∏—Å—Ç–≤–∞–Ω–µ](#–ø–æ—á–∏—Å—Ç–≤–∞–Ω–µ)

---

## üéØ –û–±—â–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

–°–∏—Å—Ç–µ–º–∞—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–µ–≤–∫–ª—é—á–≤–∞ tenant-–∞ –≤ **read-only —Ä–µ–∂–∏–º** –∫–æ–≥–∞—Ç–æ:
- Subscription-—ä—Ç –∏–∑—Ç–µ—á–µ (`current_period_end` –µ –≤ –º–∏–Ω–∞–ª–æ—Ç–æ)
- Grace –ø–µ—Ä–∏–æ–¥—ä—Ç (10 –¥–Ω–∏) –∏–∑—Ç–µ—á–µ (`grace_until` –µ –≤ –º–∏–Ω–∞–ª–æ—Ç–æ)
- JWT —Ç–æ–∫–µ–Ω—ä—Ç –∏–∑—Ç–µ—á–µ (–∞–∫–æ –µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–∞–Ω —Å –∫—Ä–∞—Ç–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç)

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∏?

```
Subscription Active ‚Üí Subscription Expired ‚Üí Grace Period (10 days) ‚Üí READ-ONLY
                      [read_only = false]    [read_only = false]     [read_only = true]
```

---

## üóÑÔ∏è –¢–µ—Å—Ç 1: Subscription Expiration (SQL)

**–§–∞–π–ª:** `supabase/TEST_expiration_readonly.sql`

### –ö–∞–∫–≤–æ —Ç–µ—Å—Ç–≤–∞?
- –°—ä–∑–¥–∞–≤–∞ —Ç–µ—Å—Ç–æ–≤ tenant –∏ subscription –∫–æ–π—Ç–æ –∏–∑—Ç–∏—á–∞ —Å–ª–µ–¥ 1 –º–∏–Ω—É—Ç–∞
- –ü—Ä–æ–≤–µ—Ä—è–≤–∞ –¥–∞–ª–∏ —Å–ª–µ–¥ –∏–∑—Ç–∏—á–∞–Ω–µ—Ç–æ tenant-—ä—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å—Ç–∞–≤–∞ read-only

### –°—Ç—ä–ø–∫–∏:

#### 1.1. –°—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ —Ç–µ—Å—Ç–∞
```sql
-- –ò–∑–ø—ä–ª–Ω–µ—Ç–µ —Ñ–∞–π–ª–∞ –≤ Supabase SQL Editor:
\i supabase/TEST_expiration_readonly.sql
```

–¢–æ–≤–∞ —â–µ:
- –°—ä–∑–¥–∞–¥–µ —Ç–µ—Å—Ç–æ–≤ tenant: `test-expiry`
- –°—ä–∑–¥–∞–¥–µ —Ç–µ—Å—Ç–æ–≤ user: `test.expiry@example.com`
- –°—ä–∑–¥–∞–¥–µ subscription –∫–æ–π—Ç–æ –∏–∑—Ç–∏—á–∞ —Å–ª–µ–¥ 1 –º–∏–Ω—É—Ç–∞
- –ü–æ–∫–∞–∂–µ –Ω–∞—á–∞–ª–Ω–∏—è —Å—Ç–∞—Ç—É—Å (active, read_only = false)

#### 1.2. –ò–∑—á–∞–∫–≤–∞–Ω–µ (1 –º–∏–Ω—É—Ç–∞ + 10 —Å–µ–∫)

–°–ª–µ–¥ —Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ —Ç–µ—Å—Ç–∞, –∏–∑—á–∞–∫–∞–π—Ç–µ **70 —Å–µ–∫—É–Ω–¥–∏** (1 –º–∏–Ω—É—Ç–∞ + 10 —Å–µ–∫ –±—É—Ñ–µ—Ä).

#### 1.3. –†—ä—á–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞
```sql
SELECT * FROM app.test_check_expiration_status(
  (SELECT id FROM app.tenants WHERE code='test-expiry')
);
```

**–û—á–∞–∫–≤–∞–Ω —Ä–µ–∑—É–ª—Ç–∞—Ç:**
```
test_step                 | expected_value | actual_value | result
--------------------------+----------------+--------------+--------
–í—Ä–µ–º–µ —Å–ª–µ–¥ –∏–∑—Ç–∏—á–∞–Ω–µ      | >1 min         | 70 sec       | ‚úì Pass
–ü–µ—Ä–∏–æ–¥ –µ –∏–∑—Ç–µ–∫—ä–ª         | –¥–∞             | –¥–∞           | ‚úì Pass
–í—Å–µ –æ—â–µ –≤ grace –ø–µ—Ä–∏–æ–¥   | –Ω–µ             | –Ω–µ           | ‚úì Pass
Status                   | expired        | expired      | ‚úì Pass
Read-only                | true           | true         | ‚úì Pass
```

#### 1.4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ (–±–ª–æ–∫–∏—Ä–∞ –∑–∞ 70 —Å–µ–∫)
```sql
SELECT * FROM app.test_auto_expiration_check(
  (SELECT id FROM app.tenants WHERE code='test-expiry')
);
```

–¢–∞–∑–∏ —Ñ—É–Ω–∫—Ü–∏—è:
- –ò–∑—á–∞–∫–≤–∞ 70 —Å–µ–∫—É–Ω–¥–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
- –ü—Ä–æ–≤–µ—Ä—è–≤–∞ —Å—Ç–∞—Ç—É—Å–∞
- –í—Ä—ä—â–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∞

**–û—á–∞–∫–≤–∞–Ω –∏–∑—Ö–æ–¥:**
```
‚úÖ –¢–ï–°–¢ –£–°–ü–ï–®–ï–ù: Tenant –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –µ –ø—Ä–µ–≤–∫–ª—é—á–µ–Ω –≤ read-only —Ä–µ–∂–∏–º!
```

---

## üîë –¢–µ—Å—Ç 2: JWT Short Expiry (SQL)

**–§–∞–π–ª:** `supabase/TEST_jwt_short_expiry.sql`

### –ö–∞–∫–≤–æ —Ç–µ—Å—Ç–≤–∞?
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞ JWT tokens —Å –∫—Ä–∞—Ç–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç (1 –º–∏–Ω—É—Ç–∞)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ JWT –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- –¢–µ—Å—Ç –Ω–∞ –ø–æ–≤–µ–¥–µ–Ω–∏–µ—Ç–æ –ø—Ä–∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω JWT

### –°—Ç—ä–ø–∫–∏:

#### 2.1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞ JWT Expiry

**–í–∞—Ä–∏–∞–Ω—Ç A: Supabase Dashboard**
1. –û—Ç–∏–¥–µ—Ç–µ –Ω–∞: `https://app.supabase.com/project/[YOUR-PROJECT]/settings/auth`
2. –ù–∞–º–µ—Ä–µ—Ç–µ "JWT Expiry"
3. –ü—Ä–æ–º–µ–Ω–µ—Ç–µ –æ—Ç `3600` (1 —á–∞—Å) –Ω–∞ `60` (1 –º–∏–Ω—É—Ç–∞)
4. –ó–∞–ø–∞–∑–µ—Ç–µ

**–í–∞—Ä–∏–∞–Ω—Ç B: Local Development (config.toml)**
```toml
[auth]
jwt_expiry = 60  # 1 –º–∏–Ω—É—Ç–∞
```

–°–ª–µ–¥ —Ç–æ–≤–∞:
```bash
supabase stop
supabase start
```

**–í–∞—Ä–∏–∞–Ω—Ç C: Environment Variable**
```bash
GOTRUE_JWT_EXPIRY=60
```

#### 2.2. –ò–∑—Ö–æ–¥ –∏ –Ω–æ–≤ –≤—Ö–æ–¥
–°–ª–µ–¥ –ø—Ä–æ–º—è–Ω–∞—Ç–∞ –Ω–∞ JWT expiry:
```sql
-- –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è—Ç —Ç—Ä—è–±–≤–∞ –¥–∞ –∏–∑–ª–µ–∑–µ –∏ –≤–ª–µ–∑–µ –æ—Ç–Ω–æ–≤–æ
```

#### 2.3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ JWT –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
```sql
SELECT * FROM app.test_jwt_info();
```

**–û—á–∞–∫–≤–∞–Ω —Ä–µ–∑—É–ª—Ç–∞—Ç:**
```
user_id                              | user_email            | token_issued_at      | token_expires_at     | seconds_until_expiry | is_expired
-------------------------------------+-----------------------+----------------------+----------------------+----------------------+-----------
550e8400-e29b-41d4-a716-446655440000 | test@example.com      | 2026-02-17 10:00:00  | 2026-02-17 10:01:00  | 45                   | false
```

#### 2.4. –¢–µ—Å—Ç –Ω–∞ JWT –≤–∞–ª–∏–¥–Ω–æ—Å—Ç
```sql
SELECT * FROM app.test_expired_jwt_behavior();
```

**–û—á–∞–∫–≤–∞–Ω —Ä–µ–∑—É–ª—Ç–∞—Ç:**
```
test_case          | expected_result         | actual_result                      | passed
-------------------+-------------------------+------------------------------------+--------
–í–∞–ª–∏–¥–µ–Ω JWT        | –§—É–Ω–∫—Ü–∏—è—Ç–∞ –¥–∞ —Å–µ –∏–∑–ø—ä–ª–Ω–∏ | ‚úÖ –§—É–Ω–∫—Ü–∏—è—Ç–∞ —Å–µ –∏–∑–ø—ä–ª–Ω–∏ —É—Å–ø–µ—à–Ω–æ    | true
JWT –≤–∞–ª–∏–¥–Ω–æ—Å—Ç      | –ù–µ –ø–æ–≤–µ—á–µ –æ—Ç 60 —Å–µ–∫—É–Ω–¥–∏ | ‚úÖ JWT –∏–∑—Ç–∏—á–∞ —Å–ª–µ–¥ 45 —Å–µ–∫          | true
```

---

## üíª –¢–µ—Å—Ç 3: Client-Side Testing (TypeScript)

**–§–∞–π–ª:** `src/utils/testExpirationReadOnly.ts`

### –ö–∞–∫–≤–æ —Ç–µ—Å—Ç–≤–∞?
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ JWT session –æ—Ç –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—Ç–∞ —Å—Ç—Ä–∞–Ω–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ entitlement —Å—Ç–∞—Ç—É—Å
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∏–∑—á–∞–∫–≤–∞–Ω–µ –∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞ read-only —Ä–µ–∂–∏–º

### –°—Ç—ä–ø–∫–∏:

#### 3.1. –ò–º–ø–æ—Ä—Ç–∏—Ä–∞–Ω–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ

–û—Ç–≤–æ—Ä–µ—Ç–µ –±—Ä–∞—É–∑—ä—Ä–Ω–∞ –∫–æ–Ω–∑–æ–ª–∞ (F12) –∏ –∏–∑–ø—ä–ª–Ω–µ—Ç–µ:

```javascript
// –ë—ä—Ä–∑–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ (–±–µ–∑ –∏–∑—á–∞–∫–≤–∞–Ω–µ)
await testExpirationReadOnly(false);

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ–Ω —Ç–µ—Å—Ç —Å –∏–∑—á–∞–∫–≤–∞–Ω–µ (–∞–∫–æ subscription –∏–∑—Ç–∏—á–∞ —Å–∫–æ—Ä–æ)
await testExpirationReadOnly(true);

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–ª–∏ read-only —Ä–µ–∂–∏–º—ä—Ç –µ –∞–∫—Ç–∏–≤–µ–Ω
await testReadOnlyOperation();
```

#### 3.2. –û—á–∞–∫–≤–∞–Ω –∏–∑—Ö–æ–¥ –≤ –∫–æ–Ω–∑–æ–ª–∞—Ç–∞

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë       –†–ï–ó–£–õ–¢–ê–¢–ò –û–¢ –¢–ï–°–¢ - EXPIRATION READ-ONLY             ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£

‚úÖ 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–µ—Å–∏—è
   JWT token –∏–∑—Ç–∏—á–∞ —Å–ª–µ–¥ 45 —Å–µ–∫—É–Ω–¥–∏
   –í—Ä–µ–º–µ: 10:00:15

‚ÑπÔ∏è 2. –¢–µ–∫—É—â entitlement
   Status: active, Read-only: false
   –í—Ä–µ–º–µ: 10:00:16

‚ÑπÔ∏è 3. –°—Ä–æ–∫ –Ω–∞ –∞–±–æ–Ω–∞–º–µ–Ω—Ç
   Subscription –∏–∑—Ç–∏—á–∞ —Å–ª–µ–¥ 45 —Å–µ–∫—É–Ω–¥–∏
   –í—Ä–µ–º–µ: 10:00:17

‚è≥ 4. –ò–∑—á–∞–∫–≤–∞–Ω–µ
   –ò–∑—á–∞–∫–≤–∞–Ω–µ 60 —Å–µ–∫—É–Ω–¥–∏ –∑–∞ –∏–∑—Ç–∏—á–∞–Ω–µ –Ω–∞ subscription...
   –í—Ä–µ–º–µ: 10:00:17

‚úÖ 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª–µ–¥ –∏–∑—Ç–∏—á–∞–Ω–µ
   ‚úÖ –£–°–ü–ï–•: Tenant –µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–µ–≤–∫–ª—é—á–µ–Ω –≤ read-only —Ä–µ–∂–∏–º!
   –í—Ä–µ–º–µ: 10:01:17

‚úÖ –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è
   –¢–µ—Å—Ç—ä—Ç –ø—Ä–∏–∫–ª—é—á–∏ —É—Å–ø–µ—à–Ω–æ
   –í—Ä–µ–º–µ: 10:01:17

‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

#### 3.3. –¢–µ—Å—Ç –Ω–∞ read-only –æ–ø–µ—Ä–∞—Ü–∏—è

```javascript
await testReadOnlyOperation();
```

**–û—á–∞–∫–≤–∞–Ω —Ä–µ–∑—É–ª—Ç–∞—Ç:**
```
‚úÖ Read-only —Ä–µ–∂–∏–º –µ –∞–∫—Ç–∏–≤–µ–Ω - –æ–ø–µ—Ä–∞—Ü–∏–∏—Ç–µ —Å–∞ –±–ª–æ–∫–∏—Ä–∞–Ω–∏
```

---

## üîÑ –ö–æ–º–±–∏–Ω–∏—Ä–∞–Ω —Ç–µ—Å—Ç

–ó–∞ –ø—ä–ª–Ω–æ —Ç–µ—Å—Ç–≤–∞–Ω–µ –Ω–∞ —Ü—è–ª–∞—Ç–∞ —Å–∏—Å—Ç–µ–º–∞:

### –°—Ç—ä–ø–∫–∞ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
```sql
-- 1.1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–∞–π—Ç–µ JWT expiry –Ω–∞ 60 —Å–µ–∫—É–Ω–¥–∏
-- (–≤–∏–∂—Ç–µ –¢–µ—Å—Ç 2, —Å—Ç—ä–ø–∫–∞ 2.1)

-- 1.2. –ò–∑–ª–µ–∑—Ç–µ –∏ –≤–ª–µ–∑—Ç–µ –æ—Ç–Ω–æ–≤–æ –≤ —Å–∏—Å—Ç–µ–º–∞—Ç–∞
```

### –°—Ç—ä–ø–∫–∞ 2: –°—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ SQL —Ç–µ—Å—Ç–∞
```sql
-- 2.1. –ò–∑–ø—ä–ª–Ω–µ—Ç–µ —Ç–µ—Å—Ç–∞ –∑–∞ subscription expiration
\i supabase/TEST_expiration_readonly.sql
```

### –°—Ç—ä–ø–∫–∞ 3: –û—Ç–≤–æ—Ä–µ—Ç–µ –±—Ä–∞—É–∑—ä—Ä–Ω–∞—Ç–∞ –∫–æ–Ω–∑–æ–ª–∞
```javascript
// 3.1. –ü—Ä–æ–≤–µ—Ä–µ—Ç–µ JWT –∏ entitlement —Å—Ç–∞—Ç—É—Å
await testExpirationReadOnly(false);
```

### –°—Ç—ä–ø–∫–∞ 4: –ò–∑—á–∞–∫–≤–∞–Ω–µ
```
–ò–∑—á–∞–∫–∞–π—Ç–µ 70 —Å–µ–∫—É–Ω–¥–∏ (1 –º–∏–Ω—É—Ç–∞ + 10 —Å–µ–∫ –±—É—Ñ–µ—Ä)
```

### –°—Ç—ä–ø–∫–∞ 5: –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è

**SQL –ø—Ä–æ–≤–µ—Ä–∫–∞:**
```sql
SELECT * FROM app.test_check_expiration_status(
  (SELECT id FROM app.tenants WHERE code='test-expiry')
);
```

**JavaScript –ø—Ä–æ–≤–µ—Ä–∫–∞:**
```javascript
await testExpirationReadOnly(false);
await testReadOnlyOperation();
```

**–û—á–∞–∫–≤–∞–Ω —Ä–µ–∑—É–ª—Ç–∞—Ç:**
- ‚úÖ Subscription status: `expired`
- ‚úÖ Read-only: `true`
- ‚úÖ JWT –µ –∏–∑—Ç–µ–∫—ä–ª (–∏–ª–∏ –±–ª–∏–∑–∫–æ –¥–æ –∏–∑—Ç–∏—á–∞–Ω–µ)
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ –±–ª–æ–∫–∏—Ä–∞ write –æ–ø–µ—Ä–∞—Ü–∏–∏

---

## üßπ –ü–æ—á–∏—Å—Ç–≤–∞–Ω–µ

–°–ª–µ–¥ –∑–∞–≤—ä—Ä—à–≤–∞–Ω–µ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–µ—Ç–µ:

### SQL –ø–æ—á–∏—Å—Ç–≤–∞–Ω–µ
```sql
-- –ò–∑—Ç—Ä–∏–≤–∞–Ω–µ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–∏—Ç–µ –¥–∞–Ω–Ω–∏
SELECT app.test_cleanup_expiration();
```

### JWT expiry –≤—ä–∑—Å—Ç–∞–Ω–æ–≤—è–≤–∞–Ω–µ
```sql
-- –í—ä—Ä–Ω–µ—Ç–µ JWT expiry –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ 3600 —Å–µ–∫—É–Ω–¥–∏ (1 —á–∞—Å)
-- Dashboard -> Settings -> Auth -> JWT Expiry: 3600
```

### –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–∏ logout
```javascript
// –í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ
await supabase.auth.signOut();
```

---

## üìä –û—á–∞–∫–≤–∞–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏

### ‚úÖ –£—Å–ø–µ—à–µ–Ω —Ç–µ—Å—Ç

–í—Å–∏—á–∫–∏ –æ—Ç —Å–ª–µ–¥–Ω–∏—Ç–µ —É—Å–ª–æ–≤–∏—è —Ç—Ä—è–±–≤–∞ –¥–∞ —Å–∞ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏:

1. **–ù–∞—á–∞–ª–Ω–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ:**
   - Status: `active`
   - Read-only: `false`
   - JWT –≤–∞–ª–∏–¥–µ–Ω

2. **–°–ª–µ–¥ –∏–∑—Ç–∏—á–∞–Ω–µ –Ω–∞ subscription:**
   - Status: `expired`
   - Read-only: `true`
   - –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ –±–ª–æ–∫–∏—Ä–∞ write –æ–ø–µ—Ä–∞—Ü–∏–∏

3. **JWT –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
   - JWT –∏–∑—Ç–∏—á–∞ —Å–ª–µ–¥ 60 —Å–µ–∫—É–Ω–¥–∏
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–±–Ω–æ–≤—è–≤–∞–Ω–µ (–∞–∫–æ –µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–∞–Ω–æ)
   - –ì—Ä–µ—à–∫–∏ –ø—Ä–∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω JWT

### ‚ùå –ß–µ—Å—Ç–æ —Å—Ä–µ—â–∞–Ω–∏ –ø—Ä–æ–±–ª–µ–º–∏

| –ü—Ä–æ–±–ª–µ–º | –ü—Ä–∏—á–∏–Ω–∞ | –†–µ—à–µ–Ω–∏–µ |
|---------|---------|---------|
| Read-only –æ—Å—Ç–∞–≤–∞ `false` | Grace –ø–µ—Ä–∏–æ–¥ –Ω–µ –µ –∏–∑—Ç–µ–∫—ä–ª | –ò–∑—á–∞–∫–∞–π—Ç–µ 10+ –¥–Ω–∏ –∏–ª–∏ –ø—Ä–æ–º–µ–Ω–µ—Ç–µ grace –Ω–∞ 0 –º–∏–Ω—É—Ç–∏ |
| JWT –Ω–µ –∏–∑—Ç–∏—á–∞ | JWT expiry –Ω–µ –µ –ø—Ä–æ–º–µ–Ω–µ–Ω | –ü—Ä–æ–≤–µ—Ä–µ—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Ç–∞ –∏ —Ä–µ—Å—Ç–∞—Ä—Ç–∏—Ä–∞–π—Ç–µ |
| –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ `entitlement_me` | –õ–∏–ø—Å–≤–∞ membership | –ü—Ä–æ–≤–µ—Ä–µ—Ç–µ –¥–∞–ª–∏ user –µ –¥–æ–±–∞–≤–µ–Ω –∫—ä–º tenant |
| –§—É–Ω–∫—Ü–∏–∏—Ç–µ –Ω–µ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞—Ç | SQL —Ñ–∞–π–ª–æ–≤–µ—Ç–µ –Ω–µ —Å–∞ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏ | –ò–∑–ø—ä–ª–Ω–µ—Ç–µ –≤—Å–∏—á–∫–∏ —Ç–µ—Å—Ç–æ–≤–∏ SQL —Ñ–∞–π–ª–æ–≤–µ |

---

## üé¨ –ö—Ä–∞—Ç–∫–∞ –≤–µ—Ä—Å–∏—è (Quick Start)

–ê–∫–æ –∏—Å–∫–∞—Ç–µ –±—ä—Ä–∑ —Ç–µ—Å—Ç (–∑–∞ –Ω–∞–ø—Ä–µ–¥–Ω–∞–ª–∏):

```sql
-- 1. –°—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ —Ç–µ—Å—Ç–∞
\i supabase/TEST_expiration_readonly.sql

-- 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ (–∏–∑—á–∞–∫–≤–∞ 70 —Å–µ–∫)
SELECT * FROM app.test_auto_expiration_check(
  (SELECT id FROM app.tenants WHERE code='test-expiry')
);

-- 3. –ü–æ—á–∏—Å—Ç–≤–∞–Ω–µ
SELECT app.test_cleanup_expiration();
```

**–í—Ä–µ–º–µ:** ~2 –º–∏–Ω—É—Ç–∏ (–≤–∫–ª—é—á–∏—Ç–µ–ª–Ω–æ –∏–∑—á–∞–∫–≤–∞–Ω–µ)

---

## üìù –ë–µ–ª–µ–∂–∫–∏

- **Grace –ø–µ—Ä–∏–æ–¥:** –ü–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ –µ 10 –¥–Ω–∏. –ó–∞ —Ç–µ—Å—Ç–≤–∞–Ω–µ –º–æ–∂–µ –¥–∞ —Å–µ –Ω–∞–º–∞–ª–∏.
- **JWT refresh:** Supabase –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–±–Ω–æ–≤—è–≤–∞ JWT –∞–∫–æ `autoRefreshToken: true`.
- **Read-only —Ä–µ–∂–∏–º:** –ë–ª–æ–∫–∏—Ä–∞ —Å–µ –Ω–∞ –Ω–∏–≤–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–Ω–µ SQL).
- **Production:** –ù–µ –∏–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ JWT=60—Å–µ–∫ –∏–ª–∏ 1-–º–∏–Ω—É—Ç–Ω–∏ subscriptions –≤ production!

---

## üîó –°–≤—ä—Ä–∑–∞–Ω–∏ —Ñ–∞–π–ª–æ–≤–µ

- `supabase/TEST_expiration_readonly.sql` - SQL —Ç–µ—Å—Ç –∑–∞ subscription expiration
- `supabase/TEST_jwt_short_expiry.sql` - SQL —Ç–µ—Å—Ç –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞ JWT
- `src/utils/testExpirationReadOnly.ts` - TypeScript —Ç–µ—Å—Ç–æ–≤–µ
- `src/contexts/EntitlementContext.tsx` - Entitlement –ª–æ–≥–∏–∫–∞
- `supabase/002_entitlement_functions.sql` - Entitlement —Ñ—É–Ω–∫—Ü–∏–∏

---

## ‚úâÔ∏è –ü–æ–¥–¥—Ä—ä–∂–∫–∞

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∏ –ø—Ä–æ–≤–µ—Ä–µ—Ç–µ:
1. Supabase logs
2. Browser console –∑–∞ JavaScript –≥—Ä–µ—à–∫–∏
3. Entitlement —Å—Ç–∞—Ç—É—Å: `SELECT * FROM app.entitlements;`
4. JWT –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è: `SELECT * FROM app.test_jwt_info();`

---

**–ü–æ—Å–ª–µ–¥–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2026-02-17  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–ê–≤—Ç–æ—Ä:** SPI Certify Team
